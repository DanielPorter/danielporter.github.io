<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Course Planner - Community College Hub</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="nav-container">
          <a href="index.html" class="nav-logo">Community Hub</a>
          <ul class="nav-menu">
            <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
            <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
            <li class="nav-item"><a href="course-catalog.html" class="nav-link">Course Catalog</a></li>
            <li class="nav-item"><a href="course-planner.html" class="nav-link active">Course Planner</a></li>
          </ul>
        </div>
      </nav>
    </header>
    
    <main>
      <section class="content">
        <h1>Course Planner</h1>
        <p>
          Each term is shown as a card. Click the term header to collapse or expand 
          the list of courses underneath it.
        </p>
        
        <!-- Container for the term cards -->
        <div id="plannerTimeline" class="planner-timeline"></div>
        
        <!-- Save Plan Button -->
        <button id="savePlanBtn">Save Plan</button>
      </section>
    </main>
    
    <footer>
      <p>&copy; 2025 Community College Hub</p>
    </footer>
    
    <script>
      // Generic function to load a JSON file
      async function loadJSON(url) {
        const response = await fetch(url);
        return response.json();
      }
      
      async function initPlanner() {
        // Load plan and courses
        const plan = await loadJSON("plan.json");
        const coursesCatalog = await loadJSON("courses.json");
        
        renderPlan(plan, coursesCatalog);

        document.getElementById("savePlanBtn").addEventListener("click", () => {
          savePlan(plan);
        });
      }
      
      function renderPlan(plan, coursesCatalog) {
        const timelineContainer = document.getElementById("plannerTimeline");
        timelineContainer.innerHTML = "";

        plan.semesters.forEach((semester) => {
          // Create a card for each term
          const termCard = document.createElement("div");
          termCard.className = "term-card expanded"; // expanded by default

          // Create the header
          const header = document.createElement("div");
          header.className = "term-header";
          header.innerHTML = `<h2>${semester.semester}</h2>`;

          // Toggle collapse/expand on click
          header.addEventListener("click", () => {
            termCard.classList.toggle("expanded");
            termBody.style.display = termCard.classList.contains("expanded") ? "block" : "none";
          });

          // Create the body (table of courses), shown by default
          const termBody = document.createElement("div");
          termBody.className = "term-body";
          termBody.style.display = "block";

          // Build a small table for the courses
          const table = document.createElement("table");
          table.className = "term-table";
          table.innerHTML = `
            <thead>
              <tr>
                <th style="padding-right: 20px;">Course</th>
                <th style="padding-right: 20px;">Title</th>
                <th style="padding-right: 20px;">Units</th>
                <th style="padding-right: 20px;">Prereqs/Coreqs</th>
              </tr>
            </thead>
            <tbody></tbody>
          `;
          
          const tbody = table.querySelector("tbody");
          
          // For each course in this term
          semester.courses.forEach(courseEntry => {
            const course = coursesCatalog.find(c => c.id === courseEntry.courseId);
            if (!course) return;
            
            let prereqText = "N/A";
            if (course.prerequisites && course.prerequisites.length > 0) {
              prereqText = "Prereqs: " + course.prerequisites.join(", ");
            }
            if (course.corequisites && course.corequisites.length > 0) {
              prereqText += prereqText === "N/A" ? "" : " | ";
              prereqText += "Coreqs: " + course.corequisites.join(", ");
            }
            if (prereqText === "N/A" && (course.prerequisites?.length > 0 || course.corequisites?.length > 0)) {
              // If there's partial data
              prereqText = prereqText.replace("N/A", "");
            }
            if (prereqText === "") prereqText = "N/A";
            
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${course.code}</td>
              <td>${course.title}</td>
              <td>${course.credits}</td>
              <td>${prereqText}</td>
            `;
            tbody.appendChild(tr);
          });

          termBody.appendChild(table);

          // Put header + body into the card
          termCard.appendChild(header);
          termCard.appendChild(termBody);
          
          // Add the card to the main container
          timelineContainer.appendChild(termCard);
        });
      }
      
      function savePlan(plan) {
        plan.updatedAt = new Date().toISOString();
        localStorage.setItem("coursePlan", JSON.stringify(plan));
        alert("Plan saved successfully!");
      }
      
      initPlanner();
    </script>
  </body>
</html>
