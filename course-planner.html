<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Course Planner - Community College Hub</title>
    <link rel="stylesheet" href="style.css"/>
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="nav-container">
          <a href="index.html" class="nav-logo">Community Hub</a>
          <ul class="nav-menu">
            <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
            <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
            <li class="nav-item"><a href="course-catalog.html" class="nav-link">Course Catalog</a></li>
            <li class="nav-item"><a href="course-planner.html" class="nav-link active">Course Planner</a></li>
          </ul>
        </div>
      </nav>
    </header>

    <main>
      <section class="content">
        <h1>Course Planner</h1>
        <p>Build your course timeline for achieving your goals.</p>
        
        <!-- Planner timeline container -->
        <div id="plannerTimeline" class="planner-timeline"></div>
        
        <!-- Save Plan Button -->
        <button id="savePlanBtn">Save Plan</button>
      </section>
    </main>

    <footer>
      <p>&copy; 2025 Community College Hub</p>
    </footer>

    <script>
      // Generic function to load JSON from a file
      async function loadJSON(url) {
        const response = await fetch(url);
        return response.json();
      }

      async function initPlanner() {
        // Load plan and courses catalog from their separate JSON files
        const plan = await loadJSON('plan.json');
        const coursesCatalog = await loadJSON('courses.json');
        
        renderTimeline(plan, coursesCatalog);

        document.getElementById("savePlanBtn").addEventListener("click", () => {
          savePlan(plan);
        });
      }

      // Render the timeline based on the plan and course catalog
      function renderTimeline(plan, coursesCatalog) {
        const timelineContainer = document.getElementById("plannerTimeline");
        timelineContainer.innerHTML = "";
        plan.semesters.forEach((semester) => {
          const semesterDiv = document.createElement("div");
          semesterDiv.className = "semester-block";
          semesterDiv.innerHTML = `<h2>${semester.semester}</h2>
            <p>Estimated Workload: ${semester.estimatedWorkload}</p>`;
          
          const coursesList = document.createElement("ul");
          coursesList.className = "semester-courses";
          semester.courses.forEach(courseEntry => {
            const course = coursesCatalog.find(c => c.id === courseEntry.courseId);
            if (course) {
              const courseItem = document.createElement("li");
              courseItem.className = "course-item";
              courseItem.innerHTML = `<strong>${course.code}</strong>: ${course.title}` +
                (courseEntry.customNotes ? ` <em>(${courseEntry.customNotes})</em>` : "");
              coursesList.appendChild(courseItem);
            }
          });
          semesterDiv.appendChild(coursesList);
          timelineContainer.appendChild(semesterDiv);
        });
      }

      // Save the plan to localStorage (or integrate with a backend later)
      function savePlan(plan) {
        plan.updatedAt = new Date().toISOString();
        localStorage.setItem("coursePlan", JSON.stringify(plan));
        alert("Plan saved successfully!");
      }

      initPlanner();
    </script>
  </body>
</html>
